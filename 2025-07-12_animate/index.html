<!DOCTYPE html>
<html>

<head>
  <!-- 3Dmol.js stuff -->
  <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
  <script>
    function init() {
      // console.log("init() started")
      viewer = $3Dmol.viewers[0]
      $3Dmol.get('traj.xyz', function (data) {
        viewer.addModelsAsFrames(data, "xyz");
        viewer.setStyle({ stick: { showNonBonded: true } });
        viewer.zoomTo();
        viewer.render();
      });
      //   console.log("init() finished")
    }
    
    function sleep(ms) {
      // See https://stackoverflow.com/a/39914235
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    async function animate_frames() {
      source = await setup_plot();

      viewer = $3Dmol.viewers[0];
      for (i = 0; i < 400; i++) {
        document.getElementById("fnum").innerHTML = i;
        await viewer.setFrame(i);
        viewer.render();
        source.selected.indices = [i];
        await sleep(1);
      }
      
    }
  </script>
  
  <!-- BokehJS stuff -->
  <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-3.7.3.min.js"></script>
  <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.7.3.min.js"></script>
  <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.7.3.min.js"></script>
  <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.7.3.min.js"></script>
  <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.7.3.min.js"></script>
  <script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-api-3.7.3.min.js"></script>
  <script>
    async function setup_plot() {
      data = await fetch("data.json")
        .then(resp => resp.json())
      const source = new Bokeh.ColumnDataSource({ data: data });
      const plot = Bokeh.Plotting.figure({});
      plot.scatter(
        { field: 'PC1' },
        { field: 'PC2' },
        { source: source, selection_color: 'red' }
      );
      Bokeh.Plotting.show(plot);
      return source
    }
    
  </script>
</head>

<body onload="init()" id="page-top" class="index">
  <div class="col-lg-6 text-center">
    <div style="position:relative;
    height: 415px;
    width: 540px;" class='viewer_3Dmoljs' data-backgroundcolor='0xffffff' data-style='stick'
    data-ui='true'>
  </div>
  <p id="fnum">Frame number</p>
  <button onclick="animate_frames()">Start Animation</button>
</div>
</body>

</html>